import{r as n,w as gl,Y as bl,b as wl,aB as yl,p as c,t as a,U as o,Q as E,S as d,ai as p,O as r,J as cl,F as M,q as b,aa as X,M as Z,T as S}from"./vue-CQnFr7Mm.js";import{_ as Vl,f as xl,k as kl,m as $l,n as hl,o as Ul,p as Cl,q as zl,u as jl,s as Fl}from"./index-CfxRCr4N.js";import{l as Sl}from"./lodash-CNPm4k7W.js";import{F as g}from"./fselect-ihsU5P9M.js";import{C as ql}from"./echart-B3Y0D_xp.js";import"./element-DYg7Q49L.js";const Tl={class:"page-index c-text-left"},Bl={class:"c-cardtitlebox c-rowbox"},Ll={style:{"min-height":"60px"},class:"contentbox"},Rl={class:"params-grid"},Dl={class:"param-group"},El={class:"param-group"},Ml={class:"param-group"},Nl={class:"param-group"},Wl={class:"param-group"},Al={class:"flexbox"},Il={class:"param-group"},Jl={class:"flexbox"},Pl={class:"param-group"},Hl={class:"tr"},Ol={class:"c-cardbox c-rowbox"},Yl={class:"lbox"},Ql={class:"rbox"},Gl={class:"c-cardtitlebox c-rowbox"},Kl={style:{"min-height":"60px"},class:"contentbox"},Xl={class:"params-grid"},Zl={class:"param-group"},la={class:"param-label"},aa={class:"param-group"},ea={class:"param-group"},sa={class:"param-group"},ta={class:"c-cardtitlebox c-rowbox"},oa={style:{"min-height":"60px"},class:"contentbox"},da={class:"params-grid"},ra={class:"param-group"},na={class:"param-group"},ua={class:"flexbox"},ia={class:"param-group"},pa={class:"param-group"},ma={class:"param-group"},va={class:"param-group"},_a={class:"param-label"},fa={class:"c-cardtitlebox c-rowbox"},ga={style:{"min-height":"60px"},class:"contentbox"},ba={class:"params-grid"},wa={class:"param-group"},ya={class:"param-group"},ca={class:"param-label"},Va={class:"flexbox"},xa={class:"flexbox",style:{width:"calc(100% - 70px)"}},ka={class:"param-group"},$a={class:"param-group"},ha={class:"param-group"},Ua={class:"param-group"},Ca={class:"param-group"},za={class:"param-group"},ja={class:"param-group"},Fa={class:"param-group"},Sa={class:"param-group"},qa={class:"param-group"},Ta={class:"titlebox"},Ba={class:"contentbox"},La={class:"c-cardtitlebox c-rowbox"},Ra={style:{"min-height":"60px"},class:"contentbox"},Da={class:"params-grid"},Ea={class:"param-group"},Ma={class:"param-group"},Na={class:"param-group"},Wa={class:"param-group"},Aa={class:"tl"},Ia={style:{margin:"0 -18px"},class:"formbox"},Ja={class:"c-scroll-contain"},Pa={class:"c-scroll-contain"},Ha={class:"c-scroll-contain"},Oa={class:"c-scroll-contain"},Ya={key:0,style:{"padding-right":"24px"},class:"c-pagination"},Qa={class:"dialog-footer"},Ga={style:{margin:"0 -18px"},class:"formbox"},Ka={class:"dialog-footer"},Xa={key:0,style:{height:"400px"}},Za={__name:"model",setup(le){jl();const ll=yl(),s=n({}),N=()=>{s.value={model_path_to_load:"./big-models/",data_type:"bfloat16",lora_path:"",lora_rank:16,lora_alpha:32,lora_dropout:.2,epoch:3,lr:"5e-6",lora_target_modules:"",checkpoint_epoch:[],batch_size:1,token_batch:10,pack_length:20520,max_seq_len:20520,system_prompt:"You are a helpful assistant.",data_path:"",output_dir:"./saved_models/",use_deepspeed:!1,gradit_checkpoing:!0,use_lora:!0,use_nlirg:!0,use_tensorboard:!!s.value.tensorboard_path,tensorboard_path:"",training_type:"sft"}};N();const al=async()=>{if(!el())return!1;let t=Sl.cloneDeep(s.value);t.lora_target_modules=t.lora_target_modules.split(/,|，|\s+/);let l=await Fl(t);l&&l.code===200&&_this.$message("训练开始成功","success")},el=()=>{if(!s.value.model_path_to_load)return window._this.$message("请选择要训练的模型","error"),!1;if(!s.value.lora_path&&s.value.use_lora&&(!s.value.lora_rank||!s.value.lora_alpha||!s.value.lora_dropout||!s.value.lora_target_modules))return window._this.$message("lora_rank,lora_alpha,lora_dropout,lora_target_modules不能为空","error"),!1;if(s.value.use_nlirg){if(!s.value.data_path)return window._this.$message("数据集路径不能为空","error"),!1;if(!s.value.epoch)return window._this.$message("训练轮数不能为空","error"),!1;if(!s.value.token_batch)return window._this.$message("token_batch不能为空","error"),!1;if(!s.value.batch_size)return window._this.$message("批次大小不能为空","error"),!1;if(!s.value.lr)return window._this.$message("学习率不能为空","error"),!1;if(!s.value.max_seq_len)return window._this.$message("序列最大长度不能为空","error"),!1;if(!s.value.pack_length)return window._this.$message(" (预训练)pack_length不能为空","error"),!1;if(!s.value.output_dir)return window._this.$message("模型保存路径不能为空","error"),!1}return!0};gl(()=>s.value.lora_path,(t,l)=>{t!=l&&t?(s.value.lora_rank="",s.value.lora_dropout="",s.value.lora_alpha="",s.value.lora_target_modules=""):t!=l&&!t&&(s.value.lora_rank=16,s.value.lora_dropout=.2,s.value.lora_alpha=32,s.value.lora_target_modules="")});const sl=()=>{N()},W=n([]);(async()=>{if(W.value.length<1){let t=await xl();t&&t.data&&t.data.model_name&&t.data.model_name.length>0&&(W.value=t.data.model_name)}})(),bl(()=>{_&&(_.close(),w.value&&clearInterval(w.value))}),wl(()=>{_&&_.close(),T()});const A=t=>{t&&window._this.$copy(t)},q=n("./data"),I=n([]),J=async()=>{let t=await kl({data_dir:q.value});t.code==200&&t.data&&(I.value=t.data)};J();const tl=async()=>{let t=await Ul({lora_path:s.value.lora_path});t.code==200&&t.data&&(s.value.lora_rank=t.data.lora_rank,s.value.lora_alpha=t.data.lora_alpha,s.value.lora_dropout=t.data.lora_dropout,s.value.lora_target_modules=t.data.target_modules?t.data.target_modules.json(","):"")};let _;const V=n(0),w=n(null),T=()=>{if(ll.path!=="/model")return!1;w.value&&(clearTimeout(w.value),w.value=null);const t=window.location.protocol==="https:"?"wss:":"ws:";let l=window.location.host;l=="192.168.50.65:5177"&&(l="192.168.50.109:8010");const u=`${t}//${l}/api/train/ws/terminal`;_&&(_=null),_=new WebSocket(u),_.onopen=()=>{h("WebSocket连接已建立，开始接收终端输出...","system")},_.onmessage=f=>{h(f.data,"output")},_.onclose=()=>{V.value=5,V.value>600&&(V.value=600),h("WebSocket连接已断开，"+V.value+"秒后尝试重连...","system"),w.value=setTimeout(T,V.value*1e3)},_.onerror=f=>{h("WebSocket连接错误","error")}};T();const h=(t,l="output")=>{const u=document.getElementById("terminal-output"),f=document.createElement("div");f.className=`terminal-line ${l}`,t=t.replace(/\u001b\[32m([^\u001b]+)\u001b\[0m/g,'<span style="color: #4ec9b0;">$1</span>'),t=t.replace(/\u001b\[31m([^\u001b]+)\u001b\[0m/g,'<span style="color: #f48771;">$1</span>'),t=t.replace(/\u001b\[34m([^\u001b]+)\u001b\[0m/g,'<span style="color: #569cd6;">$1</span>'),t=t.replace(/\u001b\[36m([^\u001b]+)\u001b\[0m/g,'<span style="color: #9cdcfe;">$1</span>'),t=t.replace(/\u001b\[90m([^\u001b]+)\u001b\[0m/g,'<span style="color: #858585;">$1</span>'),f.innerHTML=t,u&&u.appendChild(f),ol()},P=n(null);function ol(){setTimeout(()=>{var t;(t=P.value)==null||t.setScrollTop(document.querySelector("#terminal-output").offsetHeight+100)},100)}const m=n({base_model_path:"./big-models/",lora_path:"./saved_models/",output_path:"./merged_models/name"}),v=n({data_path:"./data",model_path:"./big-models/",smooth_window:5,z_score_threshold:.5}),y=n(""),x=n(1),U=n(10),C=n(0),z=n(!1),H=n([]),B=async()=>{if(!y.value)return window._this.$message("请先开始评估任务","error");let t=await $l({output_path:y.value,page_index:x.value,page_size:U.value});t.code==200&&(H.value=t.data.data||[],C.value=t.data.total,z.value=!0)},L=n(!1),O=n({}),dl=t=>{console.log(t),O.value=t.loss_entropy_analyze_result,L.value=!0},rl=async()=>{if(!m.value.base_model_path||!m.value.output_path||!m.value.lora_path)return window._this.$message("请填写完整信息","error");let t=await zl(m.value);t.code==200&&t.data&&window._this.$message("模型合并成功","success")},nl=async()=>{let t=await hl(v.value);t.code==200&&t.data&&(y.value=t.data.output_path,window._this.$message("评估任务开启，请耐心等待。","success"),k.value=!0)},ul=async()=>{let t=await Cl({data_path:s.value.data_path});t.code==200&&t.data&&il(t.data)},Y=n({}),j=n(!1),il=t=>{j.value=!0,Y.value=t},pl=()=>{let t=[];for(let l=0;l<s.value.epoch;l++)t.push(l);return t},k=n(!1);return(t,l)=>{const u=p("el-input-number"),f=p("el-input"),i=p("el-button"),R=p("el-radio"),ml=p("el-radio-group"),F=p("el-switch"),Q=p("el-option"),G=p("el-select"),D=p("el-scrollbar"),$=p("el-table-column"),vl=p("el-table"),_l=p("el-pagination"),K=p("el-drawer"),fl=p("json-viewer");return b(),c(M,null,[a("div",Tl,[a("div",Bl,[l[77]||(l[77]=a("div",{style:{"justify-content":"flex-start"},class:"titlebox"},[a("h1",{class:"module-title"},[a("i",{class:"fas fa-star-half-alt"}),d(" 训练语料评估 ")]),a("label",{class:"param-label"},"语料质量评估工具：分数越高学习困难度越大，需要排查语料中存在的问题。（非必要过程，但是建议先评估后训练）")],-1)),a("div",Ll,[a("div",Rl,[a("div",Dl,[l[66]||(l[66]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d("模型路径 ")],-1)),o(g,{modelValue:v.value.model_path,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value.model_path=e)},null,8,["modelValue"])]),a("div",El,[l[67]||(l[67]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d("要评估语料路径：必须是包含文件名的完整路径 ")],-1)),o(g,{target_type:"file",modelValue:v.value.data_path,"onUpdate:modelValue":l[1]||(l[1]=e=>v.value.data_path=e)},null,8,["modelValue"])]),a("div",Ml,[l[68]||(l[68]=a("label",{class:"param-label"}," token窗口大小 ",-1)),o(u,{"controls-position":"right",step:1,min:1,onFocus:l[2]||(l[2]=e=>e.target.select()),style:{width:"100%"},modelValue:v.value.smooth_window,"onUpdate:modelValue":l[3]||(l[3]=e=>v.value.smooth_window=e),placeholder:""},null,8,["modelValue"])]),a("div",Nl,[l[69]||(l[69]=a("label",{class:"param-label"}," 判定异常阈值(熵和损失的背离阈值) ",-1)),o(u,{controls:!1,onFocus:l[4]||(l[4]=e=>e.target.select()),style:{width:"100%"},modelValue:v.value.z_score_threshold,"onUpdate:modelValue":l[5]||(l[5]=e=>v.value.z_score_threshold=e),placeholder:""},null,8,["modelValue"])]),a("div",Wl,[l[70]||(l[70]=a("label",{class:"param-label"},"语料评估完成将保存的路径 ",-1)),a("div",Al,[o(f,{disabled:"",type:"text",placeholder:"",onFocus:l[6]||(l[6]=e=>e.target.select()),style:{width:"100%"},modelValue:y.value,"onUpdate:modelValue":l[7]||(l[7]=e=>y.value=e)},null,8,["modelValue"])])]),a("div",Il,[l[72]||(l[72]=a("label",{class:"param-label"},"   ",-1)),a("div",Jl,[o(i,{onClick:l[8]||(l[8]=e=>B()),type:"success"},{default:r(()=>l[71]||(l[71]=[d("查看结果")])),_:1})])]),l[76]||(l[76]=a("div",{class:"param-group"},null,-1)),a("div",Pl,[l[75]||(l[75]=a("label",{class:"param-label"},"   ",-1)),a("div",Hl,[o(i,{onClick:l[9]||(l[9]=e=>{v.value.data_path="./data",v.value.model_path="./big-models/",v.value.smooth_window=5,v.value.z_score_threshold=.5,y.value=""}),type:"info"},{default:r(()=>l[73]||(l[73]=[a("i",{class:"fas fa-redo"},null,-1),d(" 重置")])),_:1}),o(i,{onClick:l[10]||(l[10]=e=>nl()),type:"success"},{default:r(()=>l[74]||(l[74]=[a("i",{class:"fas fa-play"},null,-1),d(" 开始评估")])),_:1})])])])])]),l[131]||(l[131]=a("div",{class:"module-header c-rowbox"},[a("h1",{class:"module-title"},[a("i",{class:"fas fa-band-aid"}),d(" 模型微调 ")])],-1)),a("div",Ol,[a("div",Yl,[o(i,{size:"large",onClick:l[11]||(l[11]=e=>s.value.training_type="sft"),type:s.value.training_type=="sft"?"primary":"info"},{default:r(()=>l[78]||(l[78]=[a("i",{class:"fas fa-chart-bar"},null,-1),d(" 指令微调（SFT）")])),_:1},8,["type"]),o(i,{size:"large",onClick:l[12]||(l[12]=e=>s.value.training_type="cpt"),type:s.value.training_type=="cpt"?"primary":"info"},{default:r(()=>l[79]||(l[79]=[a("i",{class:"fas fa-chart-line"},null,-1),d(" 预训练（CPT）")])),_:1},8,["type"])]),a("div",Ql,[o(i,{onClick:sl,tabindex:"-1",type:"info"},{default:r(()=>l[80]||(l[80]=[a("i",{class:"fas fa-redo"},null,-1),d(" 重置")])),_:1}),o(i,{onClick:al,tabindex:"-1",type:"success"},{default:r(()=>l[81]||(l[81]=[a("i",{class:"fas fa-play"},null,-1),d(" 开始训练")])),_:1})])]),a("div",Gl,[l[90]||(l[90]=a("div",{class:"titlebox"},[a("span",null,[a("i",{class:"fas fa-sliders-h"}),d(" 模型配置 ")])],-1)),a("div",Kl,[a("div",Xl,[a("div",Zl,[a("label",la,[l[82]||(l[82]=a("span",{class:"c-danger"},"*",-1)),l[83]||(l[83]=d(" 要训练的模型：请将模型文件放入big-models目录下 ")),a("span",{onClick:l[13]||(l[13]=e=>A(s.value.model_path_to_load)),class:"c-primary-btn"},"复制")]),o(g,{modelValue:s.value.model_path_to_load,"onUpdate:modelValue":l[14]||(l[14]=e=>s.value.model_path_to_load=e)},null,8,["modelValue"])]),a("div",aa,[l[87]||(l[87]=a("label",{class:"param-label"},"精度",-1)),o(ml,{modelValue:s.value.data_type,"onUpdate:modelValue":l[15]||(l[15]=e=>s.value.data_type=e)},{default:r(()=>[o(R,{value:"float16",size:"large"},{default:r(()=>l[84]||(l[84]=[d("float16")])),_:1}),o(R,{value:"float32",size:"large"},{default:r(()=>l[85]||(l[85]=[d("float32")])),_:1}),o(R,{value:"bfloat16",size:"large"},{default:r(()=>l[86]||(l[86]=[d("bfloat16")])),_:1})]),_:1},8,["modelValue"])]),a("div",ea,[l[88]||(l[88]=a("label",{class:"param-label"},"是否启用梯度检查点",-1)),o(F,{modelValue:s.value.gradit_checkpoing,"onUpdate:modelValue":l[16]||(l[16]=e=>s.value.gradit_checkpoing=e)},null,8,["modelValue"])]),a("div",sa,[l[89]||(l[89]=a("label",{class:"param-label"},"deepSeed 多卡分布式训练",-1)),o(F,{modelValue:s.value.use_deepspeed,"onUpdate:modelValue":l[17]||(l[17]=e=>s.value.use_deepspeed=e)},null,8,["modelValue"])])])])]),a("div",ta,[l[102]||(l[102]=a("div",{class:"titlebox"},[a("span",null,[a("i",{class:"fas fa-sliders-h"}),d(" Lora配置 ")])],-1)),a("div",oa,[a("div",da,[a("div",ra,[l[91]||(l[91]=a("label",{class:"param-label"},"是否使用lora微调 ",-1)),o(F,{modelValue:s.value.use_lora,"onUpdate:modelValue":l[18]||(l[18]=e=>s.value.use_lora=e)},null,8,["modelValue"])]),a("div",na,[l[93]||(l[93]=a("label",{class:"param-label"},[d("要加载的lora路径 "),a("span",{title:"如果需要基于已训练lora继续训练，请在此处填写上一个lora的保存路径",class:"far fa-question-circle"})],-1)),a("div",ua,[o(g,{style:{width:"calc(100% - 100px)"},modelValue:s.value.lora_path,"onUpdate:modelValue":l[19]||(l[19]=e=>s.value.lora_path=e)},null,8,["modelValue"]),o(i,{onClick:l[20]||(l[20]=e=>tl()),type:"success"},{default:r(()=>l[92]||(l[92]=[d("加载参数")])),_:1})])]),l[100]||(l[100]=a("div",{class:"param-group"},null,-1)),l[101]||(l[101]=a("div",{class:"param-group"},null,-1)),a("div",ia,[l[94]||(l[94]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" lora_rank "),a("span",{title:"rank 越高，LoRA适配器能够学习到的权重更新越复杂，可能带来更好的微调效果",class:"far fa-question-circle"})],-1)),o(u,{disabled:!!s.value.lora_path,controls:!1,onFocus:l[21]||(l[21]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.lora_rank,"onUpdate:modelValue":l[22]||(l[22]=e=>s.value.lora_rank=e),placeholder:""},null,8,["disabled","modelValue"])]),a("div",pa,[l[95]||(l[95]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" lora_alpha "),a("span",{title:"适应强度：alpha 越大，LoRA适配器的贡献越大，模型更倾向于学习新任务的模式；alpha 越小，模型更依赖原始预训练权重。",class:"far fa-question-circle"})],-1)),o(u,{disabled:!!s.value.lora_path,controls:!1,onFocus:l[23]||(l[23]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.lora_alpha,"onUpdate:modelValue":l[24]||(l[24]=e=>s.value.lora_alpha=e),placeholder:""},null,8,["disabled","modelValue"])]),a("div",ma,[l[96]||(l[96]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" lora_dropout"),a("span",{title:"防止过拟合：较高的 dropout（如0.2-0.5）可以增强模型的泛化能力，尤其适用于数据量较小或任务复杂的场景。",class:"far fa-question-circle"})],-1)),o(u,{disabled:!!s.value.lora_path,controls:!1,onFocus:l[25]||(l[25]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.lora_dropout,"onUpdate:modelValue":l[26]||(l[26]=e=>s.value.lora_dropout=e),placeholder:""},null,8,["disabled","modelValue"])]),a("div",va,[a("label",_a,[l[97]||(l[97]=a("span",{class:"c-danger"},"*",-1)),l[98]||(l[98]=d(" lora_target_modules")),l[99]||(l[99]=a("span",{title:"需要应用 LoRA 的目标模块列表",class:"far fa-question-circle"},null,-1)),a("span",{onClick:l[27]||(l[27]=e=>s.value.lora_target_modules="q_proj,k_proj,v_proj,o_proj,gate_proj,up_proj,down_proj"),class:"c-primary-btn"},"使用默认值")]),o(f,{disabled:!!s.value.lora_path,type:"text",placeholder:"用英文逗号分割（q_proj, v_proj, k_proj, o_proj, gate_proj, up_proj, down_proj）",controls:!1,onFocus:l[28]||(l[28]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.lora_target_modules,"onUpdate:modelValue":l[29]||(l[29]=e=>s.value.lora_target_modules=e)},null,8,["disabled","modelValue"])])])])]),a("div",fa,[l[118]||(l[118]=a("div",{class:"titlebox"},[a("span",null,[a("i",{class:"fas fa-sliders-h"}),d(" 训练配置 ")])],-1)),a("div",ga,[a("div",ba,[a("div",wa,[l[103]||(l[103]=a("label",{class:"param-label"},"开启nlirg算法(核心算法，默认启用) ",-1)),o(F,{modelValue:s.value.use_nlirg,"onUpdate:modelValue":l[30]||(l[30]=e=>s.value.use_nlirg=e)},null,8,["modelValue"])]),a("div",ya,[a("label",ca,[l[104]||(l[104]=a("span",{class:"c-danger"},"*",-1)),l[105]||(l[105]=d(" 数据路径 ")),l[106]||(l[106]=a("span",{style:{"margin-left":"70px"}},"数据集",-1)),a("span",{onClick:l[31]||(l[31]=e=>A(s.value.data_path)),class:"c-primary-btn"},"复制")]),a("div",Va,[a("div",xa,[o(g,{onBlur:l[32]||(l[32]=e=>J()),style:{width:"120px"},modelValue:q.value,"onUpdate:modelValue":l[33]||(l[33]=e=>q.value=e)},null,8,["modelValue"]),o(G,{multiple:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":2,style:{width:"calc(100% - 120px)"},modelValue:s.value.data_path,"onUpdate:modelValue":l[34]||(l[34]=e=>s.value.data_path=e),placeholder:"请选择"},{default:r(()=>[(b(!0),c(M,null,X(I.value,e=>(b(),Z(Q,{key:e.data_path,label:e.name,value:e.data_path},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),o(i,{onClick:l[35]||(l[35]=e=>ul()),type:"success"},{default:r(()=>l[107]||(l[107]=[d("预览")])),_:1})])]),a("div",ka,[l[108]||(l[108]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 训练轮数")],-1)),o(u,{"controls-position":"right",step:1,min:1,onFocus:l[36]||(l[36]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.epoch,"onUpdate:modelValue":l[37]||(l[37]=e=>s.value.epoch=e),placeholder:""},null,8,["modelValue"])]),a("div",$a,[l[109]||(l[109]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" token_batch(每批几个token)"),a("span",{title:"数量越大速度越快，但是效果越差，建议设置为10，最大不要超过20",class:"far fa-question-circle"})],-1)),o(u,{disabled:!s.value.use_nlirg,controls:!1,onFocus:l[38]||(l[38]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.token_batch,"onUpdate:modelValue":l[39]||(l[39]=e=>s.value.token_batch=e),placeholder:""},null,8,["disabled","modelValue"])]),a("div",ha,[l[110]||(l[110]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 批次大小")],-1)),o(u,{disabled:s.value.use_nlirg,controls:!1,onFocus:l[40]||(l[40]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.batch_size,"onUpdate:modelValue":l[41]||(l[41]=e=>s.value.batch_size=e),placeholder:""},null,8,["disabled","modelValue"])]),a("div",Ua,[l[111]||(l[111]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 学习率")],-1)),o(f,{type:"text",onFocus:l[42]||(l[42]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.lr,"onUpdate:modelValue":l[43]||(l[43]=e=>s.value.lr=e),placeholder:""},null,8,["modelValue"])]),a("div",Ca,[l[112]||(l[112]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 序列最大长度")],-1)),o(u,{controls:!1,onFocus:l[44]||(l[44]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.max_seq_len,"onUpdate:modelValue":l[45]||(l[45]=e=>s.value.max_seq_len=e),placeholder:""},null,8,["modelValue"])]),a("div",za,[l[113]||(l[113]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" (预训练)pack_length")],-1)),o(u,{disabled:s.value.training_type=="sft",controls:!1,onFocus:l[46]||(l[46]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.pack_length,"onUpdate:modelValue":l[47]||(l[47]=e=>s.value.pack_length=e),placeholder:""},null,8,["disabled","modelValue"])]),a("div",ja,[l[114]||(l[114]=a("label",{class:"param-label"},"需要保存的检查点（输入数字回车即可）",-1)),o(G,{disabled:s.value.use_deepspeed,style:{width:"100%"},modelValue:s.value.checkpoint_epoch,"onUpdate:modelValue":l[48]||(l[48]=e=>s.value.checkpoint_epoch=e),multiple:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,"allow-create":"","default-first-option":"",placeholder:"请选择"},{default:r(()=>[(b(!0),c(M,null,X(pl(),e=>(b(),Z(Q,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),a("div",Fa,[l[115]||(l[115]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 训练权重文件的保存路径")],-1)),o(g,{style:{width:"100%"},modelValue:s.value.output_dir,"onUpdate:modelValue":l[49]||(l[49]=e=>s.value.output_dir=e)},null,8,["modelValue"])]),a("div",Sa,[l[116]||(l[116]=a("label",{class:"param-label"},"TensorBoard日志保存路径 ",-1)),o(g,{style:{width:"100%"},modelValue:s.value.tensorboard_path,"onUpdate:modelValue":l[50]||(l[50]=e=>s.value.tensorboard_path=e)},null,8,["modelValue"])]),a("div",qa,[l[117]||(l[117]=a("label",{class:"param-label"},"默认系统提示词 ",-1)),o(f,{type:"text",disabled:s.value.training_type=="cpt",onFocus:l[51]||(l[51]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.system_prompt,"onUpdate:modelValue":l[52]||(l[52]=e=>s.value.system_prompt=e),placeholder:""},null,8,["disabled","modelValue"])])])])]),a("div",{id:"js-kzt",class:cl([{fixed:k.value},"c-cardtitlebox c-rowbox"])},[a("div",Ta,[l[119]||(l[119]=a("span",null,[a("i",{class:"fas fa-sliders-h"}),d(" 控制台 ")],-1)),k.value?(b(),c("i",{key:0,onClick:l[53]||(l[53]=e=>{k.value=!1}),style:{cursor:"pointer"},class:"fas fa-times"})):E("",!0)]),a("div",Ba,[o(D,{ref_key:"scrollbarRef",ref:P,"max-height":"300"},{default:r(()=>l[120]||(l[120]=[a("div",{class:"terminal-body"},[a("div",{id:"terminal-output",class:"terminal-output"})],-1)])),_:1},512)])],2),a("div",La,[l[127]||(l[127]=a("div",{class:"titlebox"},[a("h1",{class:"module-title"},[a("i",{class:"fas fa-puzzle-piece"}),d(" Lora合并工具 ")])],-1)),a("div",Ra,[a("div",Da,[a("div",Ea,[l[121]||(l[121]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 基座模型路径 ")],-1)),o(g,{style:{width:"100%"},modelValue:m.value.base_model_path,"onUpdate:modelValue":l[54]||(l[54]=e=>m.value.base_model_path=e)},null,8,["modelValue"])]),a("div",Ma,[l[122]||(l[122]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" Lora路径 ")],-1)),o(g,{style:{width:"100%"},modelValue:m.value.lora_path,"onUpdate:modelValue":l[55]||(l[55]=e=>m.value.lora_path=e)},null,8,["modelValue"])]),a("div",Na,[l[123]||(l[123]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 合并后的模型路径 ")],-1)),o(g,{style:{width:"100%"},modelValue:m.value.output_path,"onUpdate:modelValue":l[56]||(l[56]=e=>m.value.output_path=e)},null,8,["modelValue"])]),a("div",Wa,[l[126]||(l[126]=a("label",{class:"param-label"},"   ",-1)),a("div",Aa,[o(i,{onClick:l[57]||(l[57]=e=>{m.value.base_model_path="./big-models/",m.value.output_path="./merged_models/name",m.value.lora_path="./saved_models/"}),type:"info"},{default:r(()=>l[124]||(l[124]=[a("i",{class:"fas fa-redo"},null,-1),d(" 重置")])),_:1}),o(i,{onClick:l[58]||(l[58]=e=>rl()),type:"success"},{default:r(()=>l[125]||(l[125]=[a("i",{class:"fas fa-play"},null,-1),d(" 开始合并")])),_:1})])])])])]),o(K,{modelValue:z.value,"onUpdate:modelValue":l[62]||(l[62]=e=>z.value=e),title:"评估结果",size:"90%"},{default:r(()=>[a("div",Ia,[o(D,null,{default:r(()=>[o(vl,{"tooltip-effect":"light",border:"",data:H.value,style:{width:"100%"}},{default:r(()=>[o($,{label:"指令"},{default:r(e=>[a("div",Ja,S(e.row.instruction),1)]),_:1}),o($,{label:"输入"},{default:r(e=>[a("div",Pa,S(e.row.input),1)]),_:1}),o($,{label:"输出"},{default:r(e=>[a("div",Ha,S(e.row.output),1)]),_:1}),o($,{width:"200",label:"难度分值"},{default:r(e=>[a("div",Oa,S(e.row.loss_entropy_analyze_result.anomaly_score),1)]),_:1}),o($,{width:"100",align:"center",label:"分析"},{default:r(e=>[o(i,{onClick:ee=>dl(e.row),type:"success",size:"small"},{default:r(()=>l[128]||(l[128]=[d("查看结果")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),C.value>0?(b(),c("div",Ya,[o(_l,{"hide-on-single-page":!1,background:"","page-size":U.value,"current-page":x.value,onSizeChange:l[59]||(l[59]=e=>{U.value=e,x.value=Math.min(Math.ceil(C.value/U.value),x.value),B()}),onCurrentChange:l[60]||(l[60]=e=>{x.value=e,B()}),"page-sizes":[30,50,100,900],layout:"total,sizes,jumper,prev, pager, next",total:C.value},null,8,["page-size","current-page","total"])])):E("",!0)]),_:1})]),a("div",Qa,[o(i,{type:"info",onClick:l[61]||(l[61]=e=>z.value=!1)},{default:r(()=>l[129]||(l[129]=[d(" 关闭 ")])),_:1})])]),_:1},8,["modelValue"]),o(K,{modelValue:j.value,"onUpdate:modelValue":l[64]||(l[64]=e=>j.value=e),title:"预览数据",size:"600px"},{default:r(()=>[a("div",Ga,[o(D,null,{default:r(()=>[o(fl,{"show-array-index":!0,sort:"","expand-depth":3,value:Y.value},null,8,["value"])]),_:1})]),a("div",Ka,[o(i,{type:"info",onClick:l[63]||(l[63]=e=>j.value=!1)},{default:r(()=>l[130]||(l[130]=[d(" 关闭 ")])),_:1})])]),_:1},8,["modelValue"]),l[132]||(l[132]=a("br",null,null,-1)),k.value?(b(),c("div",Xa)):E("",!0)]),o(ql,{ref:"curechart",modelValue:L.value,"onUpdate:modelValue":l[65]||(l[65]=e=>L.value=e),data:O.value},null,8,["modelValue","data"])],64)}}},ue=Vl(Za,[["__scopeId","data-v-534c0faf"]]);export{ue as default};
