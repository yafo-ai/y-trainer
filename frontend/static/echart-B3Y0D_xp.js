import{_ as U,u as j}from"./index-CfxRCr4N.js";import{r as n,w as q,b as G,p as f,M as J,t as d,F as k,aa as S,J as B,T as w,O as h,U as $,ai as C,S as W,aB as H,aC as K,q as p}from"./vue-CQnFr7Mm.js";const P={class:"tokenbox"},Q=["onClick"],X={class:"tokenbox"},Y=["onClick"],ee={class:"dialog-footer"},te={__name:"echart",props:{title:{type:[String,Number],default:"样本难度分析"},isnoDialog:{type:Boolean,default:()=>!1},data:{type:[Object],default:()=>{}},modelValue:{type:Boolean,default:!1}},emits:["subfn","update:modelValue"],setup(A,{expose:z,emit:F}){const r=A,R=F;H(),K(),j();const x=n(!1);q(()=>r.modelValue,async(a,e)=>{r.isnoDialog||(x.value=a,a&&y(r.data))}),G(()=>{y(r.data)});const m=n(null);let c=null;const _=n([]),D=n([]),V=n([]),N=n([]),L=n([]),i=n([]),E=n([]),b=n([]),y=a=>{console.log(a,"curdata");let e=a||r.data||{};D.value=e.error_spans||[];let t=e.debug_data||{};V.value=t.loss||[],N.value=t.entropy||[],L.value=t.divergence_score||[],i.value=t.token||[],_.value=t.pattern||[];let l=[];i.value.forEach((s,o)=>{l.push(o)}),E.value=l,setTimeout(()=>{I()},100)},v=a=>_.value[a]==="Normal"?"":"("+_.value[a]+")",O=()=>{let a=[];return D.value.forEach(e=>{let t=[];e.start_idx&&t.push({xAxis:e.start_idx}),e.end_idx&&t.push({xAxis:e.end_idx}),t.length>0&&a.push(t)}),console.log(a),b.value=a,a},T=a=>{const e={title:{text:r.isnoDialog?r.title:""},tooltip:{trigger:"axis",enterable:!1,formatter:function(t){let l=t[0].dataIndex,s='<div class="c-echarttip-title">'+i.value[l]+'<span style="color:#9c2727;font-size:0.8em;">'+v(l)+"</span></div>";return t.forEach(o=>{s+='<div class="c-echarttip-item"><span class="c-label">'+o.seriesName+' : </span><span class="c-val">'+o.value.toFixed(8)+"</span></div>"}),s}},legend:{data:["损失","熵"]},grid:{left:"3%",right:"4%",bottom:"8%",containLabel:!0},toolbox:{feature:{saveAsImage:{title:"保存为图片"},magicType:{type:["line","bar"],title:{line:"折线图",bar:"柱状图"}}}},xAxis:{type:"category",boundaryGap:!1,data:E.value,triggerEvent:!0,axisLabel:{formatter:function(t,l,s){return v(t)?(console.log(t,l,s),"{b|"+i.value[t]+"}"):i.value[t]},rich:{a:{color:"#9c2727",fontSize:14},b:{color:"#9c2727",fontSize:14,fontWeight:"bold"}}}},yAxis:{axisLabel:{formatter:function(t){return t.toFixed(4)}}},series:[{name:"损失",type:"line",data:V.value,markArea:{itemStyle:{color:"rgba(255, 173, 177, 0.1)"},data:b.value}},{name:"熵",type:"line",data:N.value,markArea:{itemStyle:{color:"rgba(255, 173, 177, 0.2)"},data:b.value}}],dataZoom:[{type:"slider",start:0,end:100}]};a&&a.setOption(e)},I=()=>{m.value&&!c&&(c=_this.$echarts.init(m.value,"zh-cn"),c.on("click",function(a){console.log(a)})),O(),T(c)},g=a=>{if(typeof a!="number"||isNaN(a)||i.value.length===0)return;if(a===-1)return c&&c.dispatchAction({type:"dataZoom",start:0,end:100}),!1;const e=i.value.length-1,t=Math.min(Math.max(0,Math.floor(a)),e),l=t/e*100,s=10/e*100;console.log(t,l);let o=Math.max(0,l-s),u=Math.min(100,l+s);c&&c.dispatchAction({type:"dataZoom",start:o,end:u})},M=()=>{R("update:modelValue",!1)};return z({init:y}),(a,e)=>{const t=C("el-scrollbar"),l=C("el-button"),s=C("el-dialog");return r.isnoDialog?(p(),f(k,{key:0},[d("div",{style:{width:"100%",height:"600px","text-align":"left"},ref_key:"chartRef",ref:m},null,512),d("div",P,[d("span",{onClick:e[0]||(e[0]=o=>g(-1)),class:"item all"},"all"),(p(!0),f(k,null,S(i.value,(o,u)=>(p(),f("span",{class:B(["item",{on:v(u)}]),onClick:Z=>g(u)},w(o),11,Q))),256))])],64)):(p(),J(s,{key:1,"align-center":"",modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=o=>x.value=o),title:A.title,onClosed:M,width:"1200"},{footer:h(()=>[d("div",ee,[$(l,{onClick:e[2]||(e[2]=o=>M())},{default:h(()=>e[4]||(e[4]=[W("取消")])),_:1})])]),default:h(()=>[$(t,{"max-height":800},{default:h(()=>[d("div",{style:{width:"100%",height:"600px","text-align":"left"},ref_key:"chartRef",ref:m},null,512),d("div",X,[d("span",{onClick:e[1]||(e[1]=o=>g(-1)),class:"item all"},"all"),(p(!0),f(k,null,S(i.value,(o,u)=>(p(),f("span",{class:B(["item",{on:v(u)}]),onClick:Z=>g(u)},w(o),11,Y))),256))])]),_:1})]),_:1},8,["modelValue","title"]))}}},le=U(te,[["__scopeId","data-v-e531c3e6"]]);export{le as C};
