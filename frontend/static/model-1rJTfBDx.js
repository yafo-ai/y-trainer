import{l as ml}from"./lodash-CNPm4k7W.js";import{_ as vl,f as _l,k as gl,m as bl,n as fl,o as wl,p as yl,q as Vl,s as cl}from"./index-yrllAQxa.js";import{F as g}from"./fselect-DH6-PXFJ.js";import{C as xl}from"./echart-Bb3MRCfu.js";import{r as u,w as kl,Y as $l,b as Ul,p as z,t as a,U as o,S as d,ai as p,O as r,F as R,q as f,aa as Q,M as G,Q as hl,T as j}from"./vue-CQnFr7Mm.js";import"./element-DYg7Q49L.js";const Cl={class:"page-index c-text-left"},zl={class:"c-cardtitlebox c-rowbox"},jl={style:{"min-height":"60px"},class:"contentbox"},Fl={class:"params-grid"},ql={class:"param-group"},Sl={class:"param-group"},Tl={class:"param-group"},Ll={class:"param-group"},Bl={class:"param-group"},Rl={class:"tl"},Dl={class:"param-group"},El={class:"flexbox"},Ml={class:"param-group"},Nl={class:"flexbox"},Wl={class:"c-cardbox c-rowbox"},Al={class:"lbox"},Pl={class:"rbox"},Hl={class:"c-cardtitlebox c-rowbox"},Il={style:{"min-height":"60px"},class:"contentbox"},Jl={class:"params-grid"},Ol={class:"param-group"},Yl={class:"param-label"},Ql={class:"param-group"},Gl={class:"param-group"},Kl={class:"param-group"},Xl={class:"c-cardtitlebox c-rowbox"},Zl={style:{"min-height":"60px"},class:"contentbox"},la={class:"params-grid"},aa={class:"param-group"},ea={class:"param-group"},sa={class:"flexbox"},ta={class:"param-group"},oa={class:"param-group"},da={class:"param-group"},ra={class:"param-group"},na={class:"param-label"},ua={class:"c-cardtitlebox c-rowbox"},ia={style:{"min-height":"60px"},class:"contentbox"},pa={class:"params-grid"},ma={class:"param-group"},va={class:"param-group"},_a={class:"param-label"},ga={class:"flexbox"},ba={class:"flexbox",style:{width:"calc(100% - 70px)"}},fa={class:"param-group"},wa={class:"param-group"},ya={class:"param-group"},Va={class:"param-group"},ca={class:"param-group"},xa={class:"param-group"},ka={class:"param-group"},$a={class:"param-group"},Ua={class:"param-group"},ha={class:"param-group"},Ca={class:"c-cardtitlebox c-rowbox"},za={class:"contentbox"},ja={class:"c-cardtitlebox c-rowbox"},Fa={style:{"min-height":"60px"},class:"contentbox"},qa={class:"params-grid"},Sa={class:"param-group"},Ta={class:"param-group"},La={class:"param-group"},Ba={class:"param-group"},Ra={class:"tl"},Da={style:{margin:"0 -18px"},class:"formbox"},Ea={class:"c-scroll-contain"},Ma={class:"c-scroll-contain"},Na={class:"c-scroll-contain"},Wa={class:"c-scroll-contain"},Aa={key:0,style:{"padding-right":"24px"},class:"c-pagination"},Pa={class:"dialog-footer"},Ha={style:{margin:"0 -18px"},class:"formbox"},Ia={class:"dialog-footer"},Ja={__name:"model",setup(Oa){const s=u({}),D=()=>{s.value={model_path_to_load:"./big-models/",data_type:"bfloat16",lora_path:"",lora_rank:16,lora_alpha:32,lora_dropout:.2,epoch:3,lr:"5e-6",lora_target_modules:"",checkpoint_epoch:[],batch_size:1,token_batch:10,pack_length:20520,max_seq_len:20520,system_prompt:"You are a helpful assistant.",data_path:"",output_dir:"./saved_models/",use_deepspeed:!1,gradit_checkpoing:!0,use_lora:!0,use_nlirg:!0,use_tensorboard:!!s.value.tensorboard_path,tensorboard_path:"",training_type:"sft"}};D();const K=async()=>{if(!X())return!1;let t=ml.cloneDeep(s.value);t.lora_target_modules=t.lora_target_modules.split(/,|，|\s+/);let l=await cl(t);l&&l.code===200&&_this.$message("训练开始成功","success")},X=()=>{if(!s.value.model_path_to_load)return window._this.$message("请选择要训练的模型","error"),!1;if(!s.value.lora_path&&s.value.use_lora&&(!s.value.lora_rank||!s.value.lora_alpha||!s.value.lora_dropout||!s.value.lora_target_modules))return window._this.$message("lora_rank,lora_alpha,lora_dropout,lora_target_modules不能为空","error"),!1;if(s.value.use_nlirg){if(!s.value.data_path)return window._this.$message("数据集路径不能为空","error"),!1;if(!s.value.epoch)return window._this.$message("训练轮数不能为空","error"),!1;if(!s.value.token_batch)return window._this.$message("token_batch不能为空","error"),!1;if(!s.value.batch_size)return window._this.$message("批次大小不能为空","error"),!1;if(!s.value.lr)return window._this.$message("学习率不能为空","error"),!1;if(!s.value.max_seq_len)return window._this.$message("序列最大长度不能为空","error"),!1;if(!s.value.pack_length)return window._this.$message(" (预训练)pack_length不能为空","error"),!1;if(!s.value.output_dir)return window._this.$message("模型保存路径不能为空","error"),!1}return!0};kl(()=>s.value.lora_path,(t,l)=>{t!=l&&t?(s.value.lora_rank="",s.value.lora_dropout="",s.value.lora_alpha="",s.value.lora_target_modules=""):t!=l&&!t&&(s.value.lora_rank=16,s.value.lora_dropout=.2,s.value.lora_alpha=32,s.value.lora_target_modules="")});const Z=()=>{D()},E=u([]);(async()=>{if(E.value.length<1){let t=await _l();t&&t.data&&t.data.model_name&&t.data.model_name.length>0&&(E.value=t.data.model_name)}})(),$l(()=>{_&&_.close()}),Ul(()=>{_&&_.close(),q()});const M=t=>{t&&window._this.$copy(t)},F=u("./data"),N=u([]),W=async()=>{let t=await gl({data_dir:F.value});t.code==200&&t.data&&(N.value=t.data)};W();const ll=async()=>{let t=await wl({lora_path:s.value.lora_path});t.code==200&&t.data&&(s.value.lora_rank=t.data.lora_rank,s.value.lora_alpha=t.data.lora_alpha,s.value.lora_dropout=t.data.lora_dropout,s.value.lora_target_modules=t.data.target_modules?t.data.target_modules.json(","):"")};let _;const w=u(0),q=()=>{const t=window.location.protocol==="https:"?"wss:":"ws:";let l=window.location.host;l=="192.168.50.65:5177"&&(l="192.168.50.109:8010");const i=`${t}//${l}/api/train/ws/terminal`;_&&(_=null),_=new WebSocket(i),_.onopen=()=>{c("WebSocket连接已建立，开始接收终端输出...","system")},_.onmessage=n=>{c(n.data,"output")},_.onclose=()=>{w.value=5,w.value>600&&(w.value=600),c("WebSocket连接已断开，"+w.value+"秒后尝试重连...","system"),setTimeout(q,w.value*1e3)},_.onerror=n=>{c("WebSocket连接错误","error")}};q();const c=(t,l="output")=>{const i=document.getElementById("terminal-output"),n=document.createElement("div");n.className=`terminal-line ${l}`,t=t.replace(/\u001b\[32m([^\u001b]+)\u001b\[0m/g,'<span style="color: #4ec9b0;">$1</span>'),t=t.replace(/\u001b\[31m([^\u001b]+)\u001b\[0m/g,'<span style="color: #f48771;">$1</span>'),t=t.replace(/\u001b\[34m([^\u001b]+)\u001b\[0m/g,'<span style="color: #569cd6;">$1</span>'),t=t.replace(/\u001b\[36m([^\u001b]+)\u001b\[0m/g,'<span style="color: #9cdcfe;">$1</span>'),t=t.replace(/\u001b\[90m([^\u001b]+)\u001b\[0m/g,'<span style="color: #858585;">$1</span>'),n.innerHTML=t,i&&i.appendChild(n),al()},A=u(null);function al(){setTimeout(()=>{var t;(t=A.value)==null||t.setScrollTop(document.querySelector("#terminal-output").offsetHeight+40)},100)}const m=u({base_model_path:"./big-models/",lora_path:"./saved_models/",output_path:"./merged_models/name"}),v=u({data_path:"./data",model_path:"./big-models/",smooth_window:5,z_score_threshold:.5}),b=u(""),y=u(1),x=u(10),k=u(0),$=u(!1),P=u([]),S=async()=>{if(!b.value)return window._this.$message("请先开始评估任务","error");let t=await fl({output_path:b.value,page_index:y.value,page_size:x.value});t.code==200&&(P.value=t.data.data||[],k.value=t.data.total,$.value=!0)},T=u(!1),H=u({}),el=t=>{console.log(t),H.value=t.loss_entropy_analyze_result,T.value=!0},sl=async()=>{if(!m.value.base_model_path||!m.value.output_path||!m.value.lora_path)return window._this.$message("请填写完整信息","error");let t=await Vl(m.value);t.code==200&&t.data&&window._this.$message("模型合并成功","success")},tl=async()=>{let t=await bl(v.value);t.code==200&&t.data&&(b.value=t.data.output_path,window._this.$message("评估任务开启，请耐心等待。","success"))},ol=async()=>{let t=await yl({data_path:s.value.data_path});t.code==200&&t.data&&dl(t.data)},I=u({}),U=u(!1),dl=t=>{U.value=!0,I.value=t},rl=()=>{let t=[];for(let l=0;l<s.value.epoch;l++)t.push(l);return t};return(t,l)=>{const i=p("el-input-number"),n=p("el-button"),h=p("el-input"),L=p("el-radio"),nl=p("el-radio-group"),C=p("el-switch"),J=p("el-option"),O=p("el-select"),B=p("el-scrollbar"),V=p("el-table-column"),ul=p("el-table"),il=p("el-pagination"),Y=p("el-drawer"),pl=p("json-viewer");return f(),z(R,null,[a("div",Cl,[a("div",zl,[l[78]||(l[78]=a("div",{style:{"justify-content":"flex-start"},class:"titlebox"},[a("h1",{class:"module-title"},[a("i",{class:"fas fa-star-half-alt"}),d(" 训练语料评估 ")]),a("label",{class:"param-label"},"语料质量评估工具：分数越高学习困难度越大，需要排查语料中存在的问题。（非必要过程，但是建议先评估后训练）")],-1)),a("div",jl,[a("div",Fl,[a("div",ql,[l[65]||(l[65]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d("模型路径 ")],-1)),o(g,{modelValue:v.value.model_path,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value.model_path=e)},null,8,["modelValue"])]),a("div",Sl,[l[66]||(l[66]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d("要评估语料路径：必须是包含文件名的完整路径 ")],-1)),o(g,{target_type:"file",modelValue:v.value.data_path,"onUpdate:modelValue":l[1]||(l[1]=e=>v.value.data_path=e)},null,8,["modelValue"])]),a("div",Tl,[l[67]||(l[67]=a("label",{class:"param-label"}," token窗口大小 ",-1)),o(i,{controls:!1,onFocus:l[2]||(l[2]=e=>e.target.select()),style:{width:"100%"},modelValue:v.value.smooth_window,"onUpdate:modelValue":l[3]||(l[3]=e=>v.value.smooth_window=e),placeholder:""},null,8,["modelValue"])]),a("div",Ll,[l[68]||(l[68]=a("label",{class:"param-label"}," 判定异常阈值(熵和损失的背离阈值) ",-1)),o(i,{controls:!1,onFocus:l[4]||(l[4]=e=>e.target.select()),style:{width:"100%"},modelValue:v.value.z_score_threshold,"onUpdate:modelValue":l[5]||(l[5]=e=>v.value.z_score_threshold=e),placeholder:""},null,8,["modelValue"])]),l[75]||(l[75]=a("div",{class:"param-group"},null,-1)),l[76]||(l[76]=a("div",{class:"param-group"},null,-1)),a("div",Bl,[l[71]||(l[71]=a("label",{class:"param-label"},"   ",-1)),a("div",Rl,[o(n,{onClick:l[6]||(l[6]=e=>{v.value.data_path="./data",v.value.model_path="./big-models/",v.value.smooth_window=5,v.value.z_score_threshold=.5,b.value=""}),type:"info"},{default:r(()=>l[69]||(l[69]=[a("i",{class:"fas fa-redo"},null,-1),d(" 重置")])),_:1}),o(n,{onClick:l[7]||(l[7]=e=>tl()),type:"success"},{default:r(()=>l[70]||(l[70]=[a("i",{class:"fas fa-play"},null,-1),d(" 开始评估")])),_:1})])]),l[77]||(l[77]=a("div",{class:"param-group"},null,-1)),a("div",Dl,[l[72]||(l[72]=a("label",{class:"param-label"},"语料评估完成将保存的路径 ",-1)),a("div",El,[o(h,{disabled:"",type:"text",placeholder:"",onFocus:l[8]||(l[8]=e=>e.target.select()),style:{width:"100%"},modelValue:b.value,"onUpdate:modelValue":l[9]||(l[9]=e=>b.value=e)},null,8,["modelValue"])])]),a("div",Ml,[l[74]||(l[74]=a("label",{class:"param-label"},"   ",-1)),a("div",Nl,[o(n,{onClick:l[10]||(l[10]=e=>S()),type:"success"},{default:r(()=>l[73]||(l[73]=[d("查看结果")])),_:1})])])])])]),l[132]||(l[132]=a("div",{class:"module-header c-rowbox"},[a("h1",{class:"module-title"},[a("i",{class:"fas fa-band-aid"}),d(" 模型微调 ")])],-1)),a("div",Wl,[a("div",Al,[o(n,{size:"large",onClick:l[11]||(l[11]=e=>s.value.training_type="sft"),type:s.value.training_type=="sft"?"primary":"info"},{default:r(()=>l[79]||(l[79]=[a("i",{class:"fas fa-chart-bar"},null,-1),d(" 指令微调（SFT）")])),_:1},8,["type"]),o(n,{size:"large",onClick:l[12]||(l[12]=e=>s.value.training_type="cpt"),type:s.value.training_type=="cpt"?"primary":"info"},{default:r(()=>l[80]||(l[80]=[a("i",{class:"fas fa-chart-line"},null,-1),d(" 预训练（CPT）")])),_:1},8,["type"])]),a("div",Pl,[o(n,{onClick:Z,tabindex:"-1",type:"info"},{default:r(()=>l[81]||(l[81]=[a("i",{class:"fas fa-redo"},null,-1),d(" 重置")])),_:1}),o(n,{onClick:K,tabindex:"-1",type:"success"},{default:r(()=>l[82]||(l[82]=[a("i",{class:"fas fa-play"},null,-1),d(" 开始训练")])),_:1})])]),a("div",Hl,[l[91]||(l[91]=a("div",{class:"titlebox"},[a("span",null,[a("i",{class:"fas fa-sliders-h"}),d(" 模型配置 ")])],-1)),a("div",Il,[a("div",Jl,[a("div",Ol,[a("label",Yl,[l[83]||(l[83]=a("span",{class:"c-danger"},"*",-1)),l[84]||(l[84]=d(" 要训练的模型：请将模型文件放入big-models目录下 ")),a("span",{onClick:l[13]||(l[13]=e=>M(s.value.model_path_to_load)),class:"c-primary-btn"},"复制")]),o(g,{modelValue:s.value.model_path_to_load,"onUpdate:modelValue":l[14]||(l[14]=e=>s.value.model_path_to_load=e)},null,8,["modelValue"])]),a("div",Ql,[l[88]||(l[88]=a("label",{class:"param-label"},"精度",-1)),o(nl,{modelValue:s.value.data_type,"onUpdate:modelValue":l[15]||(l[15]=e=>s.value.data_type=e)},{default:r(()=>[o(L,{value:"float16",size:"large"},{default:r(()=>l[85]||(l[85]=[d("float16")])),_:1}),o(L,{value:"float32",size:"large"},{default:r(()=>l[86]||(l[86]=[d("float32")])),_:1}),o(L,{value:"bfloat16",size:"large"},{default:r(()=>l[87]||(l[87]=[d("bfloat16")])),_:1})]),_:1},8,["modelValue"])]),a("div",Gl,[l[89]||(l[89]=a("label",{class:"param-label"},"是否启用梯度检查点",-1)),o(C,{modelValue:s.value.gradit_checkpoing,"onUpdate:modelValue":l[16]||(l[16]=e=>s.value.gradit_checkpoing=e)},null,8,["modelValue"])]),a("div",Kl,[l[90]||(l[90]=a("label",{class:"param-label"},"deepSeed 多卡分布式训练",-1)),o(C,{modelValue:s.value.use_deepspeed,"onUpdate:modelValue":l[17]||(l[17]=e=>s.value.use_deepspeed=e)},null,8,["modelValue"])])])])]),a("div",Xl,[l[103]||(l[103]=a("div",{class:"titlebox"},[a("span",null,[a("i",{class:"fas fa-sliders-h"}),d(" Lora配置 ")])],-1)),a("div",Zl,[a("div",la,[a("div",aa,[l[92]||(l[92]=a("label",{class:"param-label"},"是否使用lora微调 ",-1)),o(C,{modelValue:s.value.use_lora,"onUpdate:modelValue":l[18]||(l[18]=e=>s.value.use_lora=e)},null,8,["modelValue"])]),a("div",ea,[l[94]||(l[94]=a("label",{class:"param-label"},[d("要加载的lora路径 "),a("span",{title:"如果需要基于已训练lora继续训练，请在此处填写上一个lora的保存路径",class:"far fa-question-circle"})],-1)),a("div",sa,[o(g,{style:{width:"calc(100% - 100px)"},modelValue:s.value.lora_path,"onUpdate:modelValue":l[19]||(l[19]=e=>s.value.lora_path=e)},null,8,["modelValue"]),o(n,{onClick:l[20]||(l[20]=e=>ll()),type:"success"},{default:r(()=>l[93]||(l[93]=[d("加载参数")])),_:1})])]),l[101]||(l[101]=a("div",{class:"param-group"},null,-1)),l[102]||(l[102]=a("div",{class:"param-group"},null,-1)),a("div",ta,[l[95]||(l[95]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" lora_rank "),a("span",{title:"rank 越高，LoRA适配器能够学习到的权重更新越复杂，可能带来更好的微调效果",class:"far fa-question-circle"})],-1)),o(i,{disabled:!!s.value.lora_path,controls:!1,onFocus:l[21]||(l[21]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.lora_rank,"onUpdate:modelValue":l[22]||(l[22]=e=>s.value.lora_rank=e),placeholder:""},null,8,["disabled","modelValue"])]),a("div",oa,[l[96]||(l[96]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" lora_alpha "),a("span",{title:"适应强度：alpha 越大，LoRA适配器的贡献越大，模型更倾向于学习新任务的模式；alpha 越小，模型更依赖原始预训练权重。",class:"far fa-question-circle"})],-1)),o(i,{disabled:!!s.value.lora_path,controls:!1,onFocus:l[23]||(l[23]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.lora_alpha,"onUpdate:modelValue":l[24]||(l[24]=e=>s.value.lora_alpha=e),placeholder:""},null,8,["disabled","modelValue"])]),a("div",da,[l[97]||(l[97]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" lora_dropout"),a("span",{title:"防止过拟合：较高的 dropout（如0.2-0.5）可以增强模型的泛化能力，尤其适用于数据量较小或任务复杂的场景。",class:"far fa-question-circle"})],-1)),o(i,{disabled:!!s.value.lora_path,controls:!1,onFocus:l[25]||(l[25]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.lora_dropout,"onUpdate:modelValue":l[26]||(l[26]=e=>s.value.lora_dropout=e),placeholder:""},null,8,["disabled","modelValue"])]),a("div",ra,[a("label",na,[l[98]||(l[98]=a("span",{class:"c-danger"},"*",-1)),l[99]||(l[99]=d(" lora_target_modules")),l[100]||(l[100]=a("span",{title:"需要应用 LoRA 的目标模块列表",class:"far fa-question-circle"},null,-1)),a("span",{onClick:l[27]||(l[27]=e=>s.value.lora_target_modules="q_proj,k_proj,v_proj,o_proj,gate_proj,up_proj,down_proj"),class:"c-primary-btn"},"使用默认值")]),o(h,{disabled:!!s.value.lora_path,type:"text",placeholder:"用英文逗号分割（q_proj, v_proj, k_proj, o_proj, gate_proj, up_proj, down_proj）",controls:!1,onFocus:l[28]||(l[28]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.lora_target_modules,"onUpdate:modelValue":l[29]||(l[29]=e=>s.value.lora_target_modules=e)},null,8,["disabled","modelValue"])])])])]),a("div",ua,[l[119]||(l[119]=a("div",{class:"titlebox"},[a("span",null,[a("i",{class:"fas fa-sliders-h"}),d(" 训练配置 ")])],-1)),a("div",ia,[a("div",pa,[a("div",ma,[l[104]||(l[104]=a("label",{class:"param-label"},"开启nlirg算法(核心算法，默认启用) ",-1)),o(C,{modelValue:s.value.use_nlirg,"onUpdate:modelValue":l[30]||(l[30]=e=>s.value.use_nlirg=e)},null,8,["modelValue"])]),a("div",va,[a("label",_a,[l[105]||(l[105]=a("span",{class:"c-danger"},"*",-1)),l[106]||(l[106]=d(" 数据路径 ")),l[107]||(l[107]=a("span",{style:{"margin-left":"70px"}},"数据集",-1)),a("span",{onClick:l[31]||(l[31]=e=>M(s.value.data_path)),class:"c-primary-btn"},"复制")]),a("div",ga,[a("div",ba,[o(g,{onBlur:l[32]||(l[32]=e=>W()),style:{width:"120px"},modelValue:F.value,"onUpdate:modelValue":l[33]||(l[33]=e=>F.value=e)},null,8,["modelValue"]),o(O,{multiple:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":2,style:{width:"calc(100% - 120px)"},modelValue:s.value.data_path,"onUpdate:modelValue":l[34]||(l[34]=e=>s.value.data_path=e),placeholder:"请选择"},{default:r(()=>[(f(!0),z(R,null,Q(N.value,e=>(f(),G(J,{key:e.data_path,label:e.name,value:e.data_path},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),o(n,{onClick:l[35]||(l[35]=e=>ol()),type:"success"},{default:r(()=>l[108]||(l[108]=[d("预览")])),_:1})])]),a("div",fa,[l[109]||(l[109]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 训练轮数")],-1)),o(i,{"controls-position":"right",step:1,min:1,onFocus:l[36]||(l[36]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.epoch,"onUpdate:modelValue":l[37]||(l[37]=e=>s.value.epoch=e),placeholder:""},null,8,["modelValue"])]),a("div",wa,[l[110]||(l[110]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" token_batch(每批几个token)"),a("span",{title:"数量越大速度越快，但是效果越差，建议设置为10，最大不要超过20",class:"far fa-question-circle"})],-1)),o(i,{disabled:!s.value.use_nlirg,controls:!1,onFocus:l[38]||(l[38]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.token_batch,"onUpdate:modelValue":l[39]||(l[39]=e=>s.value.token_batch=e),placeholder:""},null,8,["disabled","modelValue"])]),a("div",ya,[l[111]||(l[111]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 批次大小")],-1)),o(i,{disabled:s.value.use_nlirg,controls:!1,onFocus:l[40]||(l[40]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.batch_size,"onUpdate:modelValue":l[41]||(l[41]=e=>s.value.batch_size=e),placeholder:""},null,8,["disabled","modelValue"])]),a("div",Va,[l[112]||(l[112]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 学习率")],-1)),o(h,{type:"text",onFocus:l[42]||(l[42]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.lr,"onUpdate:modelValue":l[43]||(l[43]=e=>s.value.lr=e),placeholder:""},null,8,["modelValue"])]),a("div",ca,[l[113]||(l[113]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 序列最大长度")],-1)),o(i,{controls:!1,onFocus:l[44]||(l[44]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.max_seq_len,"onUpdate:modelValue":l[45]||(l[45]=e=>s.value.max_seq_len=e),placeholder:""},null,8,["modelValue"])]),a("div",xa,[l[114]||(l[114]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" (预训练)pack_length")],-1)),o(i,{disabled:s.value.training_type=="sft",controls:!1,onFocus:l[46]||(l[46]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.pack_length,"onUpdate:modelValue":l[47]||(l[47]=e=>s.value.pack_length=e),placeholder:""},null,8,["disabled","modelValue"])]),a("div",ka,[l[115]||(l[115]=a("label",{class:"param-label"},"需要保存的检查点（输入数字回车即可）",-1)),o(O,{disabled:s.value.use_deepspeed,style:{width:"100%"},modelValue:s.value.checkpoint_epoch,"onUpdate:modelValue":l[48]||(l[48]=e=>s.value.checkpoint_epoch=e),multiple:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,"allow-create":"","default-first-option":"",placeholder:"请选择"},{default:r(()=>[(f(!0),z(R,null,Q(rl(),e=>(f(),G(J,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),a("div",$a,[l[116]||(l[116]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 训练权重文件的保存路径")],-1)),o(g,{style:{width:"100%"},modelValue:s.value.output_dir,"onUpdate:modelValue":l[49]||(l[49]=e=>s.value.output_dir=e)},null,8,["modelValue"])]),a("div",Ua,[l[117]||(l[117]=a("label",{class:"param-label"},"TensorBoard日志保存路径 ",-1)),o(g,{style:{width:"100%"},modelValue:s.value.tensorboard_path,"onUpdate:modelValue":l[50]||(l[50]=e=>s.value.tensorboard_path=e)},null,8,["modelValue"])]),a("div",ha,[l[118]||(l[118]=a("label",{class:"param-label"},"默认系统提示词 ",-1)),o(h,{type:"text",disabled:s.value.training_type=="cpt",onFocus:l[51]||(l[51]=e=>e.target.select()),style:{width:"100%"},modelValue:s.value.system_prompt,"onUpdate:modelValue":l[52]||(l[52]=e=>s.value.system_prompt=e),placeholder:""},null,8,["disabled","modelValue"])])])])]),a("div",Ca,[l[121]||(l[121]=a("div",{class:"titlebox"},[a("span",null,[a("i",{class:"fas fa-sliders-h"}),d(" 微调进度 ")])],-1)),a("div",za,[o(B,{ref_key:"scrollbarRef",ref:A,"max-height":"500"},{default:r(()=>l[120]||(l[120]=[a("div",{class:"terminal-body"},[a("div",{id:"terminal-output",class:"terminal-output"})],-1)])),_:1},512)])]),a("div",ja,[l[128]||(l[128]=a("div",{class:"titlebox"},[a("h1",{class:"module-title"},[a("i",{class:"fas fa-puzzle-piece"}),d(" Lora合并工具 ")])],-1)),a("div",Fa,[a("div",qa,[a("div",Sa,[l[122]||(l[122]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 基座模型路径 ")],-1)),o(g,{style:{width:"100%"},modelValue:m.value.base_model_path,"onUpdate:modelValue":l[53]||(l[53]=e=>m.value.base_model_path=e)},null,8,["modelValue"])]),a("div",Ta,[l[123]||(l[123]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" Lora路径 ")],-1)),o(g,{style:{width:"100%"},modelValue:m.value.lora_path,"onUpdate:modelValue":l[54]||(l[54]=e=>m.value.lora_path=e)},null,8,["modelValue"])]),a("div",La,[l[124]||(l[124]=a("label",{class:"param-label"},[a("span",{class:"c-danger"},"*"),d(" 合并后的模型路径 ")],-1)),o(g,{style:{width:"100%"},modelValue:m.value.output_path,"onUpdate:modelValue":l[55]||(l[55]=e=>m.value.output_path=e)},null,8,["modelValue"])]),a("div",Ba,[l[127]||(l[127]=a("label",{class:"param-label"},"   ",-1)),a("div",Ra,[o(n,{onClick:l[56]||(l[56]=e=>{m.value.base_model_path="./big-models/",m.value.output_path="./merged_models/name",m.value.lora_path="./saved_models/"}),type:"info"},{default:r(()=>l[125]||(l[125]=[a("i",{class:"fas fa-redo"},null,-1),d(" 重置")])),_:1}),o(n,{onClick:l[57]||(l[57]=e=>sl()),type:"success"},{default:r(()=>l[126]||(l[126]=[a("i",{class:"fas fa-play"},null,-1),d(" 开始合并")])),_:1})])])])])]),o(Y,{modelValue:$.value,"onUpdate:modelValue":l[61]||(l[61]=e=>$.value=e),title:"评估结果",size:"90%"},{default:r(()=>[a("div",Da,[o(B,null,{default:r(()=>[o(ul,{"tooltip-effect":"light",border:"",data:P.value,style:{width:"100%"}},{default:r(()=>[o(V,{label:"指令"},{default:r(e=>[a("div",Ea,j(e.row.instruction),1)]),_:1}),o(V,{label:"输入"},{default:r(e=>[a("div",Ma,j(e.row.input),1)]),_:1}),o(V,{label:"输出"},{default:r(e=>[a("div",Na,j(e.row.output),1)]),_:1}),o(V,{width:"200",label:"难度分值"},{default:r(e=>[a("div",Wa,j(e.row.loss_entropy_analyze_result.anomaly_score),1)]),_:1}),o(V,{width:"100",align:"center",label:"分析"},{default:r(e=>[o(n,{onClick:Qa=>el(e.row),type:"success",size:"small"},{default:r(()=>l[129]||(l[129]=[d("查看结果")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),k.value>0?(f(),z("div",Aa,[o(il,{"hide-on-single-page":!1,background:"","page-size":x.value,"current-page":y.value,onSizeChange:l[58]||(l[58]=e=>{x.value=e,y.value=Math.min(Math.ceil(k.value/x.value),y.value),S()}),onCurrentChange:l[59]||(l[59]=e=>{y.value=e,S()}),"page-sizes":[30,50,100,900],layout:"total,sizes,jumper,prev, pager, next",total:k.value},null,8,["page-size","current-page","total"])])):hl("",!0)]),_:1})]),a("div",Pa,[o(n,{type:"info",onClick:l[60]||(l[60]=e=>$.value=!1)},{default:r(()=>l[130]||(l[130]=[d(" 关闭 ")])),_:1})])]),_:1},8,["modelValue"]),o(Y,{modelValue:U.value,"onUpdate:modelValue":l[63]||(l[63]=e=>U.value=e),title:"预览数据",size:"600px"},{default:r(()=>[a("div",Ha,[o(B,null,{default:r(()=>[o(pl,{"show-array-index":!0,sort:"","expand-depth":3,value:I.value},null,8,["value"])]),_:1})]),a("div",Ia,[o(n,{type:"info",onClick:l[62]||(l[62]=e=>U.value=!1)},{default:r(()=>l[131]||(l[131]=[d(" 关闭 ")])),_:1})])]),_:1},8,["modelValue"]),l[133]||(l[133]=a("br",null,null,-1))]),o(xl,{ref:"curechart",modelValue:T.value,"onUpdate:modelValue":l[64]||(l[64]=e=>T.value=e),data:H.value},null,8,["modelValue","data"])],64)}}},ee=vl(Ja,[["__scopeId","data-v-b6a1ed57"]]);export{ee as default};
