- [English](../README.md)
- [ä¸­æ–‡](README_zh.md)

---

# Y-Trainer

Y-Trainer æ˜¯ä¸€ä¸ªLLMæ¨¡å‹å¾®è°ƒè®­ç»ƒæ¡†æ¶ã€‚

# ğŸ“Š æ ¸å¿ƒä¼˜åŠ¿ï¼š

- ğŸ“‰ **ç²¾å‡†å¯¹æŠ—è¿‡æ‹Ÿåˆ**ï¼š ä¸“é—¨ä¼˜åŒ–ï¼Œæœ‰æ•ˆè§£å†³SFTä¸­çš„è¿‡æ‹Ÿåˆéš¾é¢˜ã€‚

- ğŸ§© **çªç ´é—å¿˜ç“¶é¢ˆ**ï¼š æ— éœ€ä¾èµ–é€šç”¨è¯­æ–™ï¼Œå³å¯å“è¶Šåœ°ä¿ç•™æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œå®ˆä½æ ¸å¿ƒèƒ½åŠ›çš„åŒæ—¶å®ç°ä¸“é¡¹æå‡ï¼

- ğŸ† **å•å¡å¼ºåŒ–å­¦ä¹ **ï¼šæ— éœ€ä¾èµ–å‚è€ƒæ¨¡å‹ã€æ•™å¸ˆæ¨¡å‹ï¼Œä»…éœ€åŸºç¡€æ¨¡å‹+å¥–åŠ±å‡½æ•°ï¼Œå³å¯ç¨³å®šçš„è¿›è¡Œå¼ºåŒ–å­¦ä¹ è®­ç»ƒã€‚

å®˜ç½‘ä»‹ç»ï¼š [Y-Trainer](https://y-agent/docs/y-trainer/introduction)

è¯¥æ¡†æ¶åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼šç»§ç»­é¢„è®­ç»ƒï¼ˆCPTï¼‰æŒ‡ä»¤å¾®è°ƒï¼ˆSFTï¼‰å¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰[å°†**å¾ˆå¿«å‘å¸ƒ**éœ€è¦é…åˆY-agentä½¿ç”¨]ã€‚

## æŒç»­é¢„è®­ç»ƒï¼ˆContinued Pre-trainingï¼‰

æ”¯æŒå¤šç§æ¨¡å‹é¢„è®­ç»ƒæ–¹æ³•ï¼Œèƒ½å¤Ÿé«˜æ•ˆåˆ©ç”¨è®­ç»ƒæ•°æ®ï¼Œæå‡æ¨¡å‹åœ¨ç‰¹å®šé¢†åŸŸçš„èƒ½åŠ›ã€‚

## ç›‘ç£å¾®è°ƒï¼ˆSupervised Fine-tuningï¼‰

ä¸ä¼ ç»Ÿ SFT ä¸åŒï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¸€å¥—è‡ªç ”çš„è®­ç»ƒæ–¹æ³•ï¼Œå…·å¤‡å¦‚ä¸‹ä¼˜åŠ¿ï¼š
- æ”¯æŒå¯¹è®­ç»ƒé¢„æ–™è¿›è¡Œè¯„åˆ†ã€‚å¯ä»¥åœ¨è®­ç»ƒä¹‹å‰ï¼Œæ’æŸ¥æœ‰é—®é¢˜çš„è¯­æ–™ã€‚
- åœ¨å°½å¯èƒ½ä¿ç•™åŸºåº§æ¨¡å‹èƒ½åŠ›çš„å‰æä¸‹ï¼Œé™åˆ¶è¯­æ–™ä¸­é”™è¯¯çŸ¥è¯†çš„å½±å“ï¼›
- æ— éœ€è¿›è¡Œæ•°æ®é›†å¹³è¡¡æ“ä½œï¼Œå®ç°å¿«é€Ÿæ”¶æ•›ï¼ŒåŒæ—¶å‡ ä¹ä¸ä¼šæŸå®³æ¨¡å‹çš„åŸå§‹èƒ½åŠ›ã€‚

## å¼ºåŒ–å­¦ä¹ ï¼ˆReinforcement Learningï¼‰

åŸºäº SFT æ„å»ºçš„å…¨æ–°å¼ºåŒ–å­¦ä¹ æ¡†æ¶ï¼Œå…·æœ‰ä»¥ä¸‹æ˜¾è‘—ä¼˜åŠ¿ï¼š

- **ä½èµ„æºéœ€æ±‚ï¼š** æ— éœ€ä¾èµ–å‚è€ƒæ¨¡å‹ã€å¥–åŠ±æ¨¡å‹ã€ä»·å€¼ç½‘ç»œç­‰ç»„ä»¶ï¼Œä»…éœ€åˆç†è®¾è®¡å¥–åŠ±å‡½æ•°å³å¯å®Œæˆè®­ç»ƒï¼›
- **è®­ç»ƒç¨³å®šï¼š** ä»¥é«˜ç†µ token ä½œä¸ºåˆ†æ”¯èŠ‚ç‚¹ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯­æ–™æ ‘ï¼Œå¹¶é€šè¿‡å†…ç½®èšç±»ç®—æ³•è¿›è¡Œå‰ªæï¼Œç¡®ä¿å……åˆ†çš„æ¢ç´¢ç©ºé—´ã€‚ç»“åˆè‡ªé€‚åº”æ¢¯åº¦è®¡ç®—ç­–ç•¥ï¼Œæ— éœ€KLæ•£åº¦çº¦æŸï¼Œæ•´ä¸ªè®­ç»ƒè¿‡ç¨‹æ›´åŠ ç¨³å®šå¯é ã€‚

# Introduction
> æ³¨æ„ï¼šæœ¬é¡¹ç›®å¯ä»¥ç”¨äºqwen2.5ã€ qwen3ç³»åˆ—æ¨¡å‹ï¼Œä¸»è¦æµ‹è¯•4Bã€7Bã€8Bç­‰æ¨¡å‹ï¼Œç›®å‰ä¸æ”¯æŒMoeæ¨¡å‹ï¼Œå¦‚æœå…¶ä»–éœ€æ±‚è¯·è”ç³»æˆ‘ä»¬ï¼ŒåŒæ—¶æ¬¢è¿å¼€æºå·¥ä½œè€…åŠ å…¥æœ¬é¡¹ç›®ã€‚

æ‚¨æ—¢å¯ä»¥è®­ç»ƒå®Œæ•´æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥ä»…è®­ç»ƒ LoRA é€‚é…å™¨ã€‚

åŒæ—¶æ”¯æŒåœ¨**å• GPU** æˆ–**å¤š GPU** ç¯å¢ƒä¸‹è¿›è¡Œè®­ç»ƒã€‚

# Installation


```bash
cd y-trainer

pip install -r requirements.txt
```

# Quick Start

é€šè¿‡å‘½ä»¤å¯åŠ¨è®­ç»ƒæœåŠ¡ï¼ˆå¯åŠ¨å‰å¯ä»¥é€šè¿‡configs/sever_config.pyä¿®æ”¹ç«¯å£å’ŒæŒ‡å®šå¤§æ¨¡å‹æ–‡ä»¶å¤¹ï¼‰

```bash
python main.py
```

æµè§ˆå™¨æ‰“å¼€ï¼šhttp://localhost:8010

å³å¯ä¾¿æ·ä½¿ç”¨è®­ç»ƒã€é›†æˆæ³¨æ„åŠ›åˆ†æã€å†…å®¹å‹ç¼©ã€æ ·æœ¬ç”Ÿæˆå’Œèšç±»ç­›é€‰åŠŸèƒ½çš„ä¸“ä¸šAIæ–‡æœ¬å¤„ç†å·¥å…·ã€‚



æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹ç¤ºä¾‹è„šæœ¬è½»æ¾è®­ç»ƒè‡ªå·±çš„æ¨¡å‹ã€‚

## å• GPU
```bash
# Continue pretraining
bash scripts/pretrain_ds.sh

# sft training
bash scripts/sft.sh
# windows sft training
./scripts/sft.bat
```

### å‚æ•°è§£é‡Š

ä»¥SFTä¸ºä¾‹ï¼Œå…¶ä»–ç±»ä¼¼
```
python -m start_training \
    --model_path_to_load model_or_path \ # éœ€è¦è®­ç»ƒçš„æ¨¡å‹ç›®å½•
    --lora_path ./lora \ # åŠ è½½loraçš„æ–‡ä»¶ç›®å½•ï¼ˆåŸºäºloraæ£€æŸ¥ç‚¹ç»§ç»­è®­ç»ƒæ˜¯é‡‡ç”¨æ­¤æ–¹å¼ï¼‰
    --training_type 'sft' \ # è®­ç»ƒæ–¹å¼
    --epoch 3 \ # è®­ç»ƒè½®æ•°
    --checkpoint_epoch '0,1' \ # ä¿å­˜æ£€æŸ¥ç‚¹è½®æ•°
    --use_NLIRG 'true'\  #æ ¸å¿ƒç®—æ³•ï¼Œé»˜è®¤å¯ç”¨
    --data_path ./data/sft_example.json \ # åŠ è½½æ•°æ®é›†çš„ä½ç½®ï¼Œä¿®æ”¹æ­¤å‚æ•°ï¼Œå¯ä»¥æŒ‡å®šä½ çš„æ•°æ®é›†æ–‡ä»¶
    --output_dir outputdir \ # è¾“å‡ºçš„æ¨¡å‹æ–‡ä»¶ç›®å½•
    --use_lora 'true' \  #ä½¿ç”¨loraæ–¹å¼è¿›è¡Œè®­ç»ƒ
    --batch_size 1 \ # ä¸å»ºè®®ä¿®æ”¹ï¼Œé»˜è®¤1
    --token_batch 10 \ # ä¸å»ºè®®ä¿®æ”¹ï¼Œé»˜è®¤10
    --lora_target_modules "q_proj,k_proj,v_proj,o_proj,gate_proj,up_proj,down_proj" # æŒ‡å®šè®­ç»ƒçš„ç½‘ç»œå±‚
```

[æ›´å¤šå‚æ•°è¯´æ˜](https://y-agent/docs/y-trainer/config).
## å¤šGPU
```bash
# Continue pretraining
bash scripts/pretrain_ds.sh

# sft training
bash scripts/sft_ds.sh
```

## è®­ç»ƒæ•°æ®æ ¼å¼ç®€ä»‹

è¿›è¡Œç»§ç»­é¢„è®­ç»ƒæ—¶, è¯·å‚è€ƒ [æ­¤æ–‡ä»¶](../example_dataset/cpt_example.json)

```json
[
  {
    "ID": 0,
    "output": "your content 1"
  },
  {
    "ID": 1,
    "output": "your content 2"
  }
]
```

è¿›è¡ŒæŒ‡ä»¤å¾®è°ƒæ—¶, è¯·å‚è€ƒ [æ­¤æ–‡ä»¶](../example_dataset/sft_example.json)
```json
[
  {
    "id": 0,
    "instruction": "instruction 0",
    "output": "output 0",
    "input": ""
  },
  {
    "id": 1,
    "instruction": "instruction 1",
    "output": "output 1",
    "input": ""
  }
]
```

åªæœ‰*output*å­—æ®µçš„tokenä¼šè¢«è®­ç»ƒã€‚

æ›´å¤šæ•™ç¨‹è¯·å‚è§ [Y-Studio å®˜æ–¹æ–‡æ¡£](https://www.y-agent.cn/docs)ã€‚

# Y-Agent Studio æ¡†æ¶ç®€ä»‹

**Y-Agent Studio** æ¡†æ¶**å®Œå…¨å¼€æº**ã€**å¯å•†ç”¨**ã€‚ä¸‹è½½åå³å¯**æ— é™åˆ¶**ä½¿ç”¨å…¨éƒ¨åŠŸèƒ½ã€‚

è¯¥æ¡†æ¶èåˆäº†**ä»£ç çš„çµæ´»æ€§**ä¸**å¯è§†åŒ–ç•Œé¢çš„ä¾¿æ·æ€§**ï¼Œæ”¯æŒä»¥ä¸‹èƒ½åŠ›ï¼š

- **æµç¨‹ç¼–æ’ä¸è¿­ä»£**
- **è‡ªåŠ¨åŒ–æµ‹è¯•**
- **è¯­æ–™æ ‡æ³¨ä¸ç”Ÿäº§ç®¡ç†**

## âœ… ä¸»è¦ç‰¹æ€§

- é«˜åº¦å¯å®šåˆ¶çš„å·¥ä½œæµï¼Œæ”¯æŒåµŒå¥—ç»“æ„ä¸æœ‰ç¯çš„å¾ªç¯è¿æ¥
- å®Œå–„çš„æ—¥å¿—ç³»ç»Ÿï¼Œæä¾›å¯è§†åŒ–å±•ç¤ºä¸è‡ªåŠ¨åŒ–åˆ†æ
- å¼€æ”¾çš„ç³»ç»Ÿé›†æˆèƒ½åŠ›ï¼Œå¯ä¸æ‚¨ç°æœ‰çš„ IT ç³»ç»Ÿæ— ç¼å¯¹æ¥
- æ”¯æŒè‡ªåŠ¨åŒ–æµ‹è¯•ã€è¯­æ–™æ ‡æ³¨ã€è¯­æ–™ç”Ÿäº§ä¸ç®¡ç†
- è§£å†³äº†å‚ç›´é¢†åŸŸè®­ç»ƒå¯¼è‡´åŸºåº§æ¨¡å‹èƒ½åŠ›ä¸‹é™çš„é—®é¢˜

## æ¶æ„å›¾ï¼ˆArchitecture Diagramï¼‰

![æ¶æ„å›¾](system_architecture.webp)
